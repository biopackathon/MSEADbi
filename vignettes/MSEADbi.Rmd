---
title: "Introduction to MSEADbi and MSEA.XXX.pb.db packages"
author: "by Kozo Nishida, Koki Tsuyuzaki, Atsushi Fukushima"
date: "`r Sys.Date()`"
output: BiocStyle::html_document
package: MSEADbi
vignette: |
    %\VignetteIndexEntry{MSEADbi}
    %\VignetteEncoding{UTF-8}
    %\VignetteEngine{knitr::rmarkdown}
---

## Introduction

MSEADbi makes it easy to generate your own annotation package for MSEA.
The package design is the same as
[MeSHDbi](https://www.bioconductor.org/packages/release/bioc/html/MeSHDbi.html)
or
[LRBaseDbi](https://bioconductor.org/packages/release/bioc/html/LRBaseDbi.html),
and the usage is also the same.

This document provides the way to use MSEADbi and MSEA.XXX.pb.db packages.
MSEA.XXX.pb.db packages provide the metabolite set by pathway for XXX species
in the [PathBank](https://pathbank.org/) database.
The packages are generated by the MSEADbi package.
MSEADbi has a role; the construction of MSEA.XXX.pb.db packages.
The makeMSEAPackage function of MSEADbi generates the user's original
MSEA.XXX.pb.db packages.

## makeMSEAPackage

Here we use makeMSEAPackage function to create a MSEA.XXX.pb.db package.
Only user have to specify are 1. a csv file that is filtered to include only the
lines of a species in [PathBank Data File](https://pathbank.org/downloads)
(Metabolite names linked to PathBank primary pathways CSV) and 2. a meta
table describing the PathBank data.
Here we use the demo data of Arabidopsis thaliana of PathBank primary pathways
CSV.

```{r}
library('MSEADbi')
tmp <- tempdir()

ath <- system.file("extdata","MSEA.Ath.pb.db_DATA.csv",package="MSEADbi")
meta <- system.file("extdata","MSEA.Ath.pb.db_METADATA.csv",package="MSEADbi")
athDf <- read.csv(ath)
metaDf <- read.csv(meta)
# We need to avoid DOT from the column names (to query with the names)
names(athDf) <- gsub("\\.", "", names(athDf))
names(metaDf) <- gsub("\\.", "", names(metaDf))

makeMSEAPackage(pkgname = "MSEA.Ath.pb.db", data=athDf, metadata=metaDf,
organism = "Arabidopsis thaliana", version = "0.99.0",
maintainer = "Kozo Nishida <kozo.nishida@gmail.com>", author = "Kozo Nishida",
destDir = tmp, license = "Artistic-2.0")

mseaPackageDir = paste(tmp, "MSEA.Ath.pb.db", sep="/")
install.packages(mseaPackageDir, repos=NULL, type="source")

```

## columns, keytypes, and select

All MSEA.XXX.pb.db package has same name object and it is instantiated by
MSEADbclass. Many data access function for this object are implmented.
For example, columns returns the rows which we can retrieve in MSEA.XXX.pb.db
packages. keytypes returns the rows which can be used as the optional parameter
in keys and select functions against MSEA.XXX.pb.db packages.
select function returns the rows in particular columns, which are having
user-specified keys. This function returns the result as a dataframe.

```{r}
library(AnnotationDbi)
library(MSEA.Ath.pb.db)

columns(MSEA.Ath.pb.db)
keytypes(MSEA.Ath.pb.db)

ids <- c('SMP0012018', 'SMP0012019')
select(MSEA.Ath.pb.db, ids, c("MetaboliteID", "CAS", "HMDBID", "ChEBIID", 
    "KEGGID"), "PathBankID")
```

## Other functions

Other additional functions like species, dbInfo, and dbconn are available.
In each MSEA.XXX.pb.db package, species function returns the common name.
dbInfo returns the information of the package.
dbfile returns the directory where sqlite file is stored.
dbschema returns the schema of database.
dbconn returns the connection to the sqlite database.

```{r}
species(MSEA.Ath.pb.db)
dbInfo(MSEA.Ath.pb.db)
dbfile(MSEA.Ath.pb.db)
dbschema(MSEA.Ath.pb.db)
dbconn(MSEA.Ath.pb.db)
```


## References

FILL bibtex for PathBank

# Session information {.unnumbered}

Here is the output of `sessionInfo()` on the system on which this
document was compiled:

```{r sessionInfo, echo=FALSE}
sessionInfo()
```